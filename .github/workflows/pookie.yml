name: Update Zee5 API

on:
  schedule:
    - cron: "0 */6 * * *"   
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install requests
        run: pip install requests

      - name: Fetch and Convert API
        run: |
          python3 << 'EOF'
          import requests, json, os

          # API Source
          url = "https://raw.githubusercontent.com/hasanhabibmottakin/Z5/refs/heads/main/rest_api.json"

          # Fetch JSON
          data = requests.get(url).json().get("data", [])

          # Convert to your Python script format
          output = []
          for ch in data:
              output.append({
                  "id": ch.get("id", ""),
                  "name": ch.get("name", ""),
                  "m3u8": ch.get("url", ""),
                  "token": "",                      
                  "useragent": "Mozilla/5.0"
              })

          # Folder check
          os.makedirs("Z5", exist_ok=True)

          # Save file
          with open("Z5/rest_api.json", "w") as f:
              json.dump(output, f, indent=2)

          print("ZEE5 API Updated Successfully")
          EOF

      - name: Commit and Push changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add Z5/rest_api.json
          git commit -m "Updated Zee5 API" || echo "No changes to commit"
          git push
